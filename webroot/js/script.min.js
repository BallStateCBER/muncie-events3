var muncieEvents={keepOpenMenus:{categories:false,datepicker:false},requestEventFilters:{category:null,tag:null},paginationPrepared:false,imagePopups:{groups_processed:[]},populatedDates:{}};function setupHeaderNav(){$("#header_datepicker").datepicker({onSelect:function(a){window.location.href="/events/day/"+a},beforeShowDay:function(d){var a=d.getDate().toString();if(a<10){a="0"+a.toString()}var h=(d.getMonth()+1).toString();if(h<10){h="0"+h}var e=d.getFullYear().toString();var c=h+"-"+e;if(muncieEvents.populatedDates.hasOwnProperty(c)){var b=muncieEvents.populatedDates[c].indexOf(a)!==-1;var g=b?"has_events":"no_events";var f=b?null:"No events"}else{var b=false;var g="no_events";var f="No events"}return[b,g,f]},}).change(function(b){var a=$(this).val();window.location.href="/events/day/"+a})}function setupSidebar(){function a(b){if(b==""){return false}if(b=="[past events]"){var c="/past_locations"}else{var c="/location/"+encodeURIComponent(b)}window.location.href=c}$("#sidebar > div.locations select").change(function(){var b=$(this).val();a(b)});$("#sidebar_select_location").submit(function(c){c.preventDefault();var b=$(this).children("select").val();a(b)})}function setupPagination(){if(muncieEvents.paginationPrepared){return}$(".paginator_select").each(function(){var a=$(this);a.change(function(){var b=a.data("url");window.location.href=b.replace("{page}",a.val())})});muncieEvents.paginationPrepared=true}function setupSearch(){$("#EventSearchForm").submit(function(){var b=$("#EventFilter");b.val($.trim(b.val()));if(b.val()==""){alert("Please enter a word or phrase in the search box to search for events.");return false}return true});var a=$("#EventFilter");a.focus(function(){var b=$("#search_options");if(b.is(":visible")){b.slideUp(200)}});a.bind("keydown",function(b){if(b.keyCode===$.ui.keyCode.TAB&&$(this).data("autocomplete").menu.active){b.preventDefault()}}).autocomplete({source:function(c,b){if($("#EventDirectionFuture").is(":checked")){var d="future"}else{if($("#EventDirectionPast").is(":checked")){var d="past"}else{var d="all"}}$.getJSON("/events/search_autocomplete/"+d,{term:extractLast(c.term)},b)},search:function(){var b=extractLast(this.value);if(b.length<2){}$("#search_autocomplete_loading").css("visibility","visible")},response:function(){$("#search_autocomplete_loading").css("visibility","hidden")},focus:function(){return false},select:function(b,c){this.value=c.item.value;return false}})}function showFlashMessages(){var a=$("#flash_messages");if(!a.is(":visible")){a.fadeIn(500)}}function hideFlashMessages(){var a=$("#flash_messages");if(a.is(":visible")){a.fadeOut(500,function(){$("#flash_messages ul").empty()})}}function insertFlashMessage(a,b){var c=$(document.createElement("li")).addClass(b).append("<p>"+a+"</p>").hide().fadeIn(500);$("#flash_messages ul").append(c);if(!$("#flash_messages").is(":visible")){showFlashMessages()}}function setupCategoriesApplyButton(){$("#apply_changed_event_categories").click(function(b){b.preventDefault();var a=new Array();$("#event_category_options input").each(function(){if($(this).is(":checked")){var c=this.id.replace("event_category_","");a.push(c)}});if(a.length){$.ajax({url:"/events/categories/categories:"+a.join(","),beforeSend:function(){$("#apply_changed_event_categories_indicator").show()},success:function(c){$("#event_categories_inner").html(c);$("#apply_changed_event_categories_indicator").hide();$.ajax({url:"/events/accordion",beforeSend:function(){$("#event_accordion_loading_indicator").show()},success:function(d){$("#event_accordion_inner").html(d)},error:function(d){$("#event_accordion_loading_indicator").hide();alert("There was an error displaying events according to your selection. Please try again.")}});$.ajax({url:"/events/upcoming_tags",beforeSend:function(){$("#tags_loading_indicator").show()},success:function(d){$("#event_tags_inner").html(d)},complete:function(){$("#tags_loading_indicator").hide()}});$("#change_event_categories").show()},error:function(){$("#apply_changed_event_categories_indicator").hide();alert("Your preferences could not be saved. Please try again.")}})}else{alert("Please select at least one category.")}})}function setupCategoriesChangeButton(){$("#change_event_categories").click(function(a){a.preventDefault();$("#event_category_options").slideDown(300,function(){$("#change_event_categories").hide()})})}function setupTagCloud(){$("#tag_cloud > a").each(function(){$(this).click(function(b){b.preventDefault();var a=$(this).data("tagSlug");$.ajax({url:"/events/accordion/tag:"+a,beforeSend:function(){$("#event_accordion_loading_indicator").show()},success:function(c){$("#event_accordion_inner").html(c)}})})})}var muncieEventsFeed={nextStartDate:null,accordions_prepared:new Array(),xfbml_parsed:new Array(),no_more_events:false};function setNextStartDate(a){muncieEventsFeed.nextStartDate=a}function setupEventAccordion(){$("ul.event_accordion").each(function(){var a=this.id;if(!a||muncieEventsFeed.accordions_prepared.indexOf(a)==-1){if(!a){this.id="event_accordion_"+(muncieEventsFeed.accordions_prepared.length+1)}$("#"+this.id+" > li > a.more_info_handle").click(function(c){c.preventDefault();var e=$(this);var d=e.data("eventId");var f=e.next(".collapse");var g=e.siblings(".tiny_thumbnails").children("a.thumbnail:first-child");if(f.is(":visible")&&f.css("height")!="0px"){if(g.length>0){g.fadeIn(150)}e.find(".address").slideUp(150);e.find(".location_details").slideUp(150)}else{if(g.length>0){g.fadeOut(500)}e.find(".address").css("display","block");e.find(".location_details").css("display","block")}var b="more_info_"+d;if(muncieEventsFeed.xfbml_parsed.indexOf(b)==-1){FB.XFBML.parse(document.getElementById(b));muncieEventsFeed.xfbml_parsed.push(b)}});muncieEventsFeed.accordions_prepared.push(this.id)}})}function loadMoreEvents(){var a="/events/index/"+muncieEventsFeed.nextStartDate+"/";if(muncieEvents.requestEventFilters.category){a="/"+muncieEvents.requestEventFilters.category+"/"+muncieEventsFeed.nextStartDate}else{if(muncieEvents.requestEventFilters.tag){a+="/tag/"+muncieEvents.requestEventFilters.tag}}$.ajax({url:a,beforeSend:function(){$("#event_accordion_loading_indicator").show()},success:function(b){$("#event_accordion_loading_indicator").hide();$("#event_accordion").append(b);muncieEventsImagePopups.prepare()},error:function(){alert("There was an error loading more events. Please try again.")},complete:function(){if($("#no_events").is(":visible")){$("#load_more_events").hide()}}})}function setNoMoreEvents(){muncieEventsFeed.no_more_events=true}function split(a){return a.split(/,\s*/)}function extractLast(a){return split(a).pop()}function MailingListToggleFreqOptions(){if($("#frequency-custom").is(":checked")){$("#custom_frequency_options").slideDown(300)}else{$("#custom_frequency_options").slideUp(300)}}function MailingListToggleEventTypeOptions(){if($("#event-categories-custom").is(":checked")){$("#custom_event_type_options").slideDown(300)}else{$("#custom_event_type_options").slideUp(300)}}function MailingListToggleBasicOptions(){if($("#settings-custom").is(":checked")){$("#custom_options").slideDown(300)}else{$("#custom_options").slideUp(300)}}function setupMailingListForm(){MailingListToggleEventTypeOptions();MailingListToggleBasicOptions();$(".frequency_options").change(function(a){MailingListToggleFreqOptions()});$(".category_options").change(function(a){MailingListToggleEventTypeOptions()});$(".settings_options").change(function(a){MailingListToggleBasicOptions()})}function prepareImagePopups(){$('a[rel*="popup"]').each(function(){var d=$(this);var c={closeBtnInside:true,type:"image",fixedContentPos:false,fixedBgPos:true,midClick:true,removalDelay:300,mainClass:"my-mfp-zoom-in"};var b=d.attr("title");var a=d.attr("rel");if(a=="popup"){c.key="single_image";if(b){c.key+="_with_caption"}else{c.key+="_no_caption"}d.magnificPopup(c)}else{if(a.indexOf("popup[")==0){if(muncieEvents.imagePopups.groups_processed.indexOf(a)!=-1){return}c.key="multiple_images";c.delegate='a[rel="'+a+'"]';c.gallery={enabled:true,navigateByImgClick:true,preload:[0,2]};d.parent().magnificPopup(c);muncieEvents.imagePopups.groups_processed.push(a)}}})};